<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced AI Agent Pro | Multi-API Support</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/atom-one-dark.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        :root {
            --primary: #6366f1;
            --primary-dark: #4f46e5;
            --secondary: #10b981;
            --accent: #f59e0b;
            --danger: #ef4444;
            --warning: #f97316;
            --info: #3b82f6;
            --dark: #0f172a;
            --darker: #020617;
            --light: #f8fafc;
            --gray: #64748b;
            --border: #334155;
            --sidebar-bg: #1e293b;
            --card-bg: #1e293b;
            --message-ai: #1e293b;
            --message-user: #3b82f6;
            --shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        body {
            background: linear-gradient(135deg, var(--darker) 0%, #1e293b 100%);
            color: var(--light);
            min-height: 100vh;
            overflow-x: hidden;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: 280px 1fr;
            gap: 0;
            height: 100vh;
        }

        /* Sidebar */
        .sidebar {
            background: var(--sidebar-bg);
            border-right: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            height: 100vh;
            overflow-y: auto;
        }

        .logo-area {
            padding: 25px 20px;
            border-bottom: 1px solid var(--border);
            text-align: center;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
            justify-content: center;
        }

        .logo-icon {
            font-size: 2.2rem;
            color: var(--accent);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        .logo h1 {
            font-size: 1.5rem;
            font-weight: 700;
            background: linear-gradient(45deg, var(--primary), var(--accent));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }

        .sidebar-tabs {
            display: flex;
            border-bottom: 1px solid var(--border);
        }

        .sidebar-tab {
            flex: 1;
            padding: 15px;
            background: none;
            border: none;
            color: var(--gray);
            cursor: pointer;
            font-size: 0.9rem;
            transition: var(--transition);
            border-bottom: 3px solid transparent;
        }

        .sidebar-tab:hover {
            color: var(--light);
            background: rgba(255, 255, 255, 0.05);
        }

        .sidebar-tab.active {
            color: var(--primary);
            border-bottom-color: var(--primary);
        }

        .tab-content {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            display: none;
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .section {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid var(--border);
        }

        .section-title {
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: 15px;
            color: var(--light);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .api-selector {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .api-option {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 15px;
            background: rgba(30, 41, 59, 0.8);
            border: 2px solid var(--border);
            border-radius: 10px;
            cursor: pointer;
            transition: var(--transition);
        }

        .api-option:hover {
            border-color: var(--primary);
            transform: translateX(5px);
        }

        .api-option.active {
            border-color: var(--primary);
            background: rgba(99, 102, 241, 0.1);
        }

        .api-icon {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
        }

        .api-icon.openrouter { background: linear-gradient(45deg, #10b981, #059669); }
        .api-icon.deepseek { background: linear-gradient(45deg, #6366f1, #4f46e5); }
        .api-icon.gemini { background: linear-gradient(45deg, #4285f4, #34a853); }
        .api-icon.claude { background: linear-gradient(45deg, #d946ef, #c026d3); }
        .api-icon.local { background: linear-gradient(45deg, #f59e0b, #d97706); }

        .api-info {
            flex: 1;
        }

        .api-name {
            font-weight: 600;
            color: var(--light);
        }

        .api-status {
            font-size: 0.8rem;
            color: var(--gray);
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
        }

        .status-dot.online { background: var(--secondary); }
        .status-dot.offline { background: var(--danger); }

        .api-input-group {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        .api-input {
            flex: 1;
            padding: 14px;
            background: rgba(15, 23, 42, 0.8);
            border: 2px solid var(--border);
            border-radius: 10px;
            color: var(--light);
            font-size: 0.95rem;
            transition: var(--transition);
        }

        .api-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.2);
        }

        .btn {
            padding: 14px 24px;
            border-radius: 10px;
            border: none;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.95rem;
        }

        .btn-primary {
            background: linear-gradient(45deg, var(--primary), var(--primary-dark));
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(99, 102, 241, 0.3);
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            color: var(--light);
            border: 1px solid var(--border);
        }

        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.15);
        }

        .btn-sm {
            padding: 10px 16px;
            font-size: 0.85rem;
        }

        .slider-container {
            margin: 20px 0;
        }

        .slider-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 0.9rem;
        }

        .slider-value {
            color: var(--accent);
            font-weight: 600;
        }

        .slider {
            width: 100%;
            height: 6px;
            -webkit-appearance: none;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
            outline: none;
        }

        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--primary);
            cursor: pointer;
            border: 3px solid var(--light);
        }

        /* Main Content */
        .main-content {
            display: flex;
            flex-direction: column;
            height: 100vh;
            overflow: hidden;
        }

        /* Top Bar */
        .top-bar {
            padding: 20px 30px;
            background: var(--sidebar-bg);
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .stats-bar {
            display: flex;
            gap: 25px;
        }

        .stat {
            text-align: center;
        }

        .stat-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--accent);
        }

        .stat-label {
            font-size: 0.8rem;
            color: var(--gray);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .top-actions {
            display: flex;
            gap: 12px;
        }

        /* Chat Container */
        .chat-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            padding: 20px 30px;
            overflow: hidden;
        }

        .messages-container {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            background: rgba(15, 23, 42, 0.5);
            border-radius: 15px;
            margin-bottom: 20px;
            scroll-behavior: smooth;
        }

        .message {
            margin-bottom: 25px;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .message-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 8px;
        }

        .message-avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 0.9rem;
        }

        .message-avatar.user {
            background: linear-gradient(45deg, var(--message-user), #2563eb);
        }

        .message-avatar.ai {
            background: linear-gradient(45deg, var(--secondary), #059669);
        }

        .message-info {
            flex: 1;
        }

        .message-sender {
            font-weight: 600;
            color: var(--light);
        }

        .message-time {
            font-size: 0.8rem;
            color: var(--gray);
        }

        .message-actions {
            display: flex;
            gap: 8px;
            opacity: 0;
            transition: var(--transition);
        }

        .message:hover .message-actions {
            opacity: 1;
        }

        .message-action {
            background: none;
            border: none;
            color: var(--gray);
            cursor: pointer;
            padding: 5px;
            border-radius: 5px;
            transition: var(--transition);
        }

        .message-action:hover {
            color: var(--light);
            background: rgba(255, 255, 255, 0.1);
        }

        .message-content {
            padding: 18px 20px;
            border-radius: 15px;
            line-height: 1.6;
            background: var(--message-ai);
            border: 1px solid var(--border);
            position: relative;
            overflow-wrap: break-word;
        }

        .message.user .message-content {
            background: var(--message-user);
            border-color: #2563eb;
            margin-left: 48px;
        }

        .message-content pre {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            padding: 15px;
            overflow-x: auto;
            margin: 10px 0;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .message-content code {
            background: rgba(0, 0, 0, 0.3);
            padding: 2px 6px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
        }

        .message-content table {
            border-collapse: collapse;
            width: 100%;
            margin: 10px 0;
        }

        .message-content th, .message-content td {
            border: 1px solid var(--border);
            padding: 8px 12px;
            text-align: left;
        }

        .message-content th {
            background: rgba(0, 0, 0, 0.2);
            font-weight: 600;
        }

        .message-content ul, .message-content ol {
            padding-left: 20px;
            margin: 10px 0;
        }

        .message-content li {
            margin-bottom: 5px;
        }

        /* Typing Indicator */
        .typing-indicator {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 15px 20px;
            background: var(--message-ai);
            border-radius: 15px;
            border: 1px solid var(--border);
            width: fit-content;
            margin-bottom: 25px;
            animation: fadeIn 0.3s ease;
        }

        .typing-dots {
            display: flex;
            gap: 4px;
        }

        .typing-dot {
            width: 8px;
            height: 8px;
            background: var(--gray);
            border-radius: 50%;
            animation: typingBounce 1.4s infinite ease-in-out;
        }

        .typing-dot:nth-child(1) { animation-delay: -0.32s; }
        .typing-dot:nth-child(2) { animation-delay: -0.16s; }

        @keyframes typingBounce {
            0%, 80%, 100% { transform: scale(0); }
            40% { transform: scale(1); }
        }

        /* Input Area */
        .input-container {
            background: var(--sidebar-bg);
            border: 1px solid var(--border);
            border-radius: 15px;
            padding: 20px;
            box-shadow: var(--shadow);
        }

        .input-tools {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        .tool-btn {
            padding: 10px 16px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--gray);
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9rem;
            transition: var(--transition);
        }

        .tool-btn:hover {
            background: rgba(255, 255, 255, 0.1);
            color: var(--light);
        }

        .tool-btn.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        .chat-input-wrapper {
            display: flex;
            gap: 15px;
            align-items: flex-end;
        }

        .chat-input {
            flex: 1;
            padding: 18px 20px;
            background: rgba(15, 23, 42, 0.8);
            border: 2px solid var(--border);
            border-radius: 12px;
            color: var(--light);
            font-size: 1rem;
            resize: none;
            min-height: 60px;
            max-height: 200px;
            line-height: 1.5;
            transition: var(--transition);
        }

        .chat-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.2);
        }

        .send-btn {
            padding: 16px 24px;
            background: linear-gradient(45deg, var(--primary), var(--primary-dark));
            color: white;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            font-weight: 600;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .send-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(99, 102, 241, 0.3);
        }

        .send-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Welcome Screen */
        .welcome-screen {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            text-align: center;
            padding: 40px;
            animation: fadeIn 0.5s ease;
        }

        .welcome-icon {
            font-size: 5rem;
            color: var(--primary);
            margin-bottom: 20px;
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        .welcome-title {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 15px;
            background: linear-gradient(45deg, var(--primary), var(--accent));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }

        .welcome-subtitle {
            font-size: 1.1rem;
            color: var(--gray);
            max-width: 600px;
            line-height: 1.6;
            margin-bottom: 40px;
        }

        .quick-actions {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            justify-content: center;
            max-width: 800px;
        }

        .quick-action {
            flex: 1;
            min-width: 250px;
            background: var(--card-bg);
            border: 1px solid var(--border);
            border-radius: 15px;
            padding: 25px;
            text-align: left;
            cursor: pointer;
            transition: var(--transition);
        }

        .quick-action:hover {
            transform: translateY(-5px);
            border-color: var(--primary);
            box-shadow: var(--shadow);
        }

        .quick-action-icon {
            font-size: 2rem;
            color: var(--primary);
            margin-bottom: 15px;
        }

        .quick-action-title {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 10px;
            color: var(--light);
        }

        .quick-action-desc {
            font-size: 0.95rem;
            color: var(--gray);
            line-height: 1.5;
        }

        /* Modals */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background: var(--sidebar-bg);
            border-radius: 20px;
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            border: 1px solid var(--border);
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.5);
            animation: modalSlideIn 0.3s ease;
        }

        @keyframes modalSlideIn {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .modal-header {
            padding: 25px 30px;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--light);
        }

        .modal-close {
            background: none;
            border: none;
            color: var(--gray);
            font-size: 1.5rem;
            cursor: pointer;
            padding: 5px;
            border-radius: 5px;
            transition: var(--transition);
        }

        .modal-close:hover {
            color: var(--light);
            background: rgba(255, 255, 255, 0.1);
        }

        .modal-body {
            padding: 30px;
        }

        .modal-footer {
            padding: 25px 30px;
            border-top: 1px solid var(--border);
            display: flex;
            justify-content: flex-end;
            gap: 15px;
        }

        /* Responsive */
        @media (max-width: 1024px) {
            .container {
                grid-template-columns: 1fr;
            }
            
            .sidebar {
                position: fixed;
                left: -280px;
                top: 0;
                z-index: 100;
                transition: var(--transition);
            }
            
            .sidebar.active {
                left: 0;
            }
            
            .mobile-menu-btn {
                display: block;
            }
        }

        @media (max-width: 768px) {
            .top-bar {
                flex-direction: column;
                gap: 20px;
                padding: 15px;
            }
            
            .stats-bar {
                width: 100%;
                justify-content: space-between;
            }
            
            .quick-actions {
                flex-direction: column;
            }
            
            .quick-action {
                min-width: 100%;
            }
            
            .chat-input-wrapper {
                flex-direction: column;
            }
            
            .send-btn {
                width: 100%;
                justify-content: center;
            }
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb {
            background: var(--primary);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--primary-dark);
        }

        /* Badges */
        .badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .badge-free {
            background: rgba(16, 185, 129, 0.2);
            color: var(--secondary);
            border: 1px solid rgba(16, 185, 129, 0.3);
        }

        .badge-pro {
            background: rgba(99, 102, 241, 0.2);
            color: var(--primary);
            border: 1px solid rgba(99, 102, 241, 0.3);
        }

        .badge-offline {
            background: rgba(239, 68, 68, 0.2);
            color: var(--danger);
            border: 1px solid rgba(239, 68, 68, 0.3);
        }

        /* Context Menu */
        .context-menu {
            position: fixed;
            background: var(--sidebar-bg);
            border: 1px solid var(--border);
            border-radius: 10px;
            padding: 8px;
            box-shadow: var(--shadow);
            z-index: 1000;
            min-width: 180px;
            display: none;
        }

        .context-item {
            padding: 10px 15px;
            border-radius: 6px;
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
            transition: var(--transition);
        }

        .context-item:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .context-divider {
            height: 1px;
            background: var(--border);
            margin: 8px 0;
        }
    </style>
</head>
<body>
    <!-- Mobile Menu Button -->
    <div class="mobile-menu-btn" style="display: none; position: fixed; top: 20px; left: 20px; z-index: 99;">
        <button class="btn btn-primary" id="mobile-menu-toggle">
            <i class="fas fa-bars"></i>
        </button>
    </div>

    <!-- Main Container -->
    <div class="container">
        <!-- Sidebar -->
        <div class="sidebar" id="sidebar">
            <div class="logo-area">
                <div class="logo">
                    <i class="fas fa-brain logo-icon"></i>
                    <h1>AI Agent Pro</h1>
                </div>
                <div class="badge badge-free" style="margin-top: 10px;">BETA v2.0</div>
            </div>

            <div class="sidebar-tabs">
                <button class="sidebar-tab active" data-tab="apis">
                    <i class="fas fa-plug"></i> APIs
                </button>
                <button class="sidebar-tab" data-tab="models">
                    <i class="fas fa-robot"></i> Models
                </button>
                <button class="sidebar-tab" data-tab="settings">
                    <i class="fas fa-cog"></i> Settings
                </button>
            </div>

            <!-- APIs Tab -->
            <div class="tab-content active" id="apis-tab">
                <div class="section">
                    <h3 class="section-title">
                        <i class="fas fa-network-wired"></i> API Connections
                    </h3>
                    <div class="api-selector">
                        <div class="api-option active" data-api="openrouter">
                            <div class="api-icon openrouter">
                                <i class="fas fa-exchange-alt"></i>
                            </div>
                            <div class="api-info">
                                <div class="api-name">OpenRouter</div>
                                <div class="api-status">
                                    <span class="status-dot online"></span>
                                    <span>Free credits available</span>
                                </div>
                            </div>
                            <div class="badge badge-free">FREE</div>
                        </div>

                        <div class="api-option" data-api="deepseek">
                            <div class="api-icon deepseek">
                                <i class="fas fa-brain"></i>
                            </div>
                            <div class="api-info">
                                <div class="api-name">DeepSeek</div>
                                <div class="api-status">
                                    <span class="status-dot offline"></span>
                                    <span>No credits</span>
                                </div>
                            </div>
                            <div class="badge badge-offline">OFFLINE</div>
                        </div>

                        <div class="api-option" data-api="gemini">
                            <div class="api-icon gemini">
                                <i class="fab fa-google"></i>
                            </div>
                            <div class="api-info">
                                <div class="api-name">Google Gemini</div>
                                <div class="api-status">
                                    <span class="status-dot online"></span>
                                    <span>Free tier</span>
                                </div>
                            </div>
                            <div class="badge badge-free">FREE</div>
                        </div>

                        <div class="api-option" data-api="claude">
                            <div class="api-icon claude">
                                <i class="fas fa-ghost"></i>
                            </div>
                            <div class="api-info">
                                <div class="api-name">Claude AI</div>
                                <div class="api-status">
                                    <span class="status-dot online"></span>
                                    <span>Limited free</span>
                                </div>
                            </div>
                            <div class="badge badge-pro">PRO</div>
                        </div>

                        <div class="api-option" data-api="local">
                            <div class="api-icon local">
                                <i class="fas fa-desktop"></i>
                            </div>
                            <div class="api-info">
                                <div class="api-name">Local AI</div>
                                <div class="api-status">
                                    <span class="status-dot offline"></span>
                                    <span>Requires setup</span>
                                </div>
                            </div>
                            <div class="badge badge-offline">SETUP</div>
                        </div>
                    </div>
                </div>

                <div class="section">
                    <h3 class="section-title">
                        <i class="fas fa-key"></i> API Configuration
                    </h3>
                    <div class="api-input-group">
                        <input type="password" class="api-input" id="api-key-input" 
                               placeholder="Enter your API key here">
                        <button class="btn btn-primary btn-sm" id="save-api-btn">
                            <i class="fas fa-save"></i> Save
                        </button>
                    </div>
                    <button class="btn btn-secondary" id="test-api-btn" style="width: 100%; margin-top: 10px;">
                        <i class="fas fa-plug"></i> Test Connection
                    </button>
                    <div style="margin-top: 15px; padding: 12px; background: rgba(239, 68, 68, 0.1); border-radius: 8px; border: 1px solid rgba(239, 68, 68, 0.3);">
                        <p style="font-size: 0.85rem; color: #fca5a5; line-height: 1.4;">
                            <i class="fas fa-exclamation-triangle"></i>
                            <strong>Important:</strong> Your DeepSeek key has no credits. Use OpenRouter for free access to DeepSeek models.
                        </p>
                    </div>
                </div>

                <div class="section">
                    <h3 class="section-title">
                        <i class="fas fa-chart-line"></i> Usage Stats
                    </h3>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                        <div style="text-align: center;">
                            <div style="font-size: 1.8rem; font-weight: 700; color: var(--accent);">0</div>
                            <div style="font-size: 0.8rem; color: var(--gray);">Tokens Used</div>
                        </div>
                        <div style="text-align: center;">
                            <div style="font-size: 1.8rem; font-weight: 700; color: var(--secondary);">$0.00</div>
                            <div style="font-size: 0.8rem; color: var(--gray);">Cost</div>
                        </div>
                    </div>
                    <div style="margin-top: 15px; height: 6px; background: rgba(255, 255, 255, 0.1); border-radius: 3px; overflow: hidden;">
                        <div style="width: 0%; height: 100%; background: linear-gradient(90deg, var(--primary), var(--accent)); transition: width 0.5s ease;"></div>
                    </div>
                    <div style="font-size: 0.8rem; color: var(--gray); text-align: center; margin-top: 5px;">
                        Free credits remaining
                    </div>
                </div>
            </div>

            <!-- Models Tab -->
            <div class="tab-content" id="models-tab">
                <div class="section">
                    <h3 class="section-title">
                        <i class="fas fa-microchip"></i> Available Models
                    </h3>
                    <div style="display: flex; flex-direction: column; gap: 12px;">
                        <div class="api-option active">
                            <div style="background: rgba(16, 185, 129, 0.2); padding: 10px; border-radius: 8px;">
                                <i class="fas fa-bolt" style="color: var(--secondary);"></i>
                            </div>
                            <div style="flex: 1;">
                                <div style="font-weight: 600;">DeepSeek Chat</div>
                                <div style="font-size: 0.85rem; color: var(--gray);">General purpose conversations</div>
                            </div>
                            <div class="badge badge-free">FREE</div>
                        </div>
                        
                        <div class="api-option">
                            <div style="background: rgba(99, 102, 241, 0.2); padding: 10px; border-radius: 8px;">
                                <i class="fas fa-code" style="color: var(--primary);"></i>
                            </div>
                            <div style="flex: 1;">
                                <div style="font-weight: 600;">DeepSeek Coder</div>
                                <div style="font-size: 0.85rem; color: var(--gray);">Programming & code generation</div>
                            </div>
                            <div class="badge badge-free">FREE</div>
                        </div>
                        
                        <div class="api-option">
                            <div style="background: rgba(59, 130, 246, 0.2); padding: 10px; border-radius: 8px;">
                                <i class="fab fa-google" style="color: #4285f4;"></i>
                            </div>
                            <div style="flex: 1;">
                                <div style="font-weight: 600;">Gemini Pro</div>
                                <div style="font-size: 0.85rem; color: var(--gray);">Google's latest model</div>
                            </div>
                            <div class="badge badge-free">FREE</div>
                        </div>
                        
                        <div class="api-option">
                            <div style="background: rgba(217, 70, 239, 0.2); padding: 10px; border-radius: 8px;">
                                <i class="fas fa-ghost" style="color: #d946ef;"></i>
                            </div>
                            <div style="flex: 1;">
                                <div style="font-weight: 600;">Claude 3 Haiku</div>
                                <div style="font-size: 0.85rem; color: var(--gray);">Fast & efficient</div>
                            </div>
                            <div class="badge badge-pro">PRO</div>
                        </div>
                    </div>
                </div>

                <div class="section">
                    <h3 class="section-title">
                        <i class="fas fa-sliders-h"></i> Model Parameters
                    </h3>
                    <div class="slider-container">
                        <div class="slider-label">
                            <span>Temperature</span>
                            <span class="slider-value" id="temp-value">0.7</span>
                        </div>
                        <input type="range" min="0" max="20" value="7" class="slider" id="temperature-slider">
                        <div style="font-size: 0.8rem; color: var(--gray); margin-top: 5px;">
                            Controls randomness (0 = deterministic, 1 = creative)
                        </div>
                    </div>

                    <div class="slider-container">
                        <div class="slider-label">
                            <span>Max Tokens</span>
                            <span class="slider-value" id="max-tokens-value">2000</span>
                        </div>
                        <input type="range" min="100" max="4000" step="100" value="2000" class="slider" id="max-tokens-slider">
                    </div>

                    <div class="slider-container">
                        <div class="slider-label">
                            <span>Top P</span>
                            <span class="slider-value" id="top-p-value">0.9</span>
                        </div>
                        <input type="range" min="0" max="10" value="9" class="slider" id="top-p-slider">
                    </div>
                </div>
            </div>

            <!-- Settings Tab -->
            <div class="tab-content" id="settings-tab">
                <div class="section">
                    <h3 class="section-title">
                        <i class="fas fa-user-cog"></i> Preferences
                    </h3>
                    <div style="display: flex; flex-direction: column; gap: 15px;">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <span>Dark Mode</span>
                            <label class="switch">
                                <input type="checkbox" checked>
                                <span class="slider round"></span>
                            </label>
                        </div>
                        
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <span>Stream Responses</span>
                            <label class="switch">
                                <input type="checkbox" checked>
                                <span class="slider round"></span>
                            </label>
                        </div>
                        
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <span>Auto-scroll</span>
                            <label class="switch">
                                <input type="checkbox" checked>
                                <span class="slider round"></span>
                            </label>
                        </div>
                        
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <span>Voice Input</span>
                            <label class="switch">
                                <input type="checkbox">
                                <span class="slider round"></span>
                            </label>
                        </div>
                    </div>
                </div>

                <div class="section">
                    <h3 class="section-title">
                        <i class="fas fa-history"></i> Chat History
                    </h3>
                    <button class="btn btn-secondary" style="width: 100%; margin-bottom: 10px;">
                        <i class="fas fa-trash"></i> Clear History
                    </button>
                    <button class="btn btn-secondary" style="width: 100%; margin-bottom: 10px;">
                        <i class="fas fa-download"></i> Export Chats
                    </button>
                    <button class="btn btn-secondary" style="width: 100%;">
                        <i class="fas fa-upload"></i> Import Chats
                    </button>
                </div>

                <div class="section">
                    <h3 class="section-title">
                        <i class="fas fa-shield-alt"></i> Security
                    </h3>
                    <p style="font-size: 0.9rem; color: var(--gray); line-height: 1.5; margin-bottom: 15px;">
                        All API keys are stored locally in your browser. No data is sent to external servers.
                    </p>
                    <button class="btn btn-secondary" style="width: 100%;">
                        <i class="fas fa-key"></i> Clear All API Keys
                    </button>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Top Bar -->
            <div class="top-bar">
                <div class="stats-bar">
                    <div class="stat">
                        <div class="stat-value" id="total-requests">0</div>
                        <div class="stat-label">Requests</div>
                    </div>
                    <div class="stat">
                        <div class="stat-value" id="total-tokens">0</div>
                        <div class="stat-label">Tokens</div>
                    </div>
                    <div class="stat">
                        <div class="stat-value" id="response-time">0s</div>
                        <div class="stat-label">Avg. Time</div>
                    </div>
                    <div class="stat">
                        <div class="stat-value" id="success-rate">100%</div>
                        <div class="stat-label">Success</div>
                    </div>
                </div>
                <div class="top-actions">
                    <button class="btn btn-secondary" id="new-chat-btn">
                        <i class="fas fa-plus"></i> New Chat
                    </button>
                    <button class="btn btn-primary" id="voice-input-btn">
                        <i class="fas fa-microphone"></i> Voice
                    </button>
                    <button class="btn btn-secondary" id="help-btn">
                        <i class="fas fa-question-circle"></i> Help
                    </button>
                </div>
            </div>

            <!-- Chat Container -->
            <div class="chat-container">
                <!-- Welcome Screen -->
                <div class="welcome-screen" id="welcome-screen">
                    <div class="welcome-icon">
                        <i class="fas fa-robot"></i>
                    </div>
                    <h1 class="welcome-title">Welcome to AI Agent Pro</h1>
                    <p class="welcome-subtitle">
                        Advanced AI assistant with multi-API support, code execution, 
                        file analysis, and real-time collaboration capabilities.
                    </p>
                    
                    <div class="quick-actions">
                        <div class="quick-action" onclick="quickAction('code')">
                            <div class="quick-action-icon">
                                <i class="fas fa-code"></i>
                            </div>
                            <div class="quick-action-title">Code Assistant</div>
                            <div class="quick-action-desc">
                                Generate, debug, and explain code in multiple programming languages
                            </div>
                        </div>
                        
                        <div class="quick-action" onclick="quickAction('analyze')">
                            <div class="quick-action-icon">
                                <i class="fas fa-chart-bar"></i>
                            </div>
                            <div class="quick-action-title">Data Analysis</div>
                            <div class="quick-action-desc">
                                Analyze data, create visualizations, and generate reports
                            </div>
                        </div>
                        
                        <div class="quick-action" onclick="quickAction('write')">
                            <div class="quick-action-icon">
                                <i class="fas fa-pen-fancy"></i>
                            </div>
                            <div class="quick-action-title">Content Writer</div>
                            <div class="quick-action-desc">
                                Create articles, emails, stories, and marketing content
                            </div>
                        </div>
                        
                        <div class="quick-action" onclick="quickAction('learn')">
                            <div class="quick-action-icon">
                                <i class="fas fa-graduation-cap"></i>
                            </div>
                            <div class="quick-action-title">Learn & Explain</div>
                            <div class="quick-action-desc">
                                Get explanations on complex topics with examples
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Messages Container -->
                <div class="messages-container" id="messages-container" style="display: none;">
                    <!-- Messages will be inserted here -->
                </div>

                <!-- Typing Indicator -->
                <div class="typing-indicator" id="typing-indicator" style="display: none;">
                    <div class="typing-dots">
                        <div class="typing-dot"></div>
                        <div class="typing-dot"></div>
                        <div class="typing-dot"></div>
                    </div>
                    <span>AI is thinking...</span>
                </div>

                <!-- Input Area -->
                <div class="input-container">
                    <div class="input-tools">
                        <button class="tool-btn" id="attach-file-btn">
                            <i class="fas fa-paperclip"></i> File
                        </button>
                        <button class="tool-btn" id="code-mode-btn">
                            <i class="fas fa-code"></i> Code
                        </button>
                        <button class="tool-btn" id="table-mode-btn">
                            <i class="fas fa-table"></i> Table
                        </button>
                        <button class="tool-btn" id="image-mode-btn">
                            <i class="fas fa-image"></i> Image
                        </button>
                        <button class="tool-btn" id="web-search-btn">
                            <i class="fas fa-search"></i> Web
                        </button>
                        <button class="tool-btn" id="translate-btn">
                            <i class="fas fa-language"></i> Translate
                        </button>
                    </div>
                    
                    <div class="chat-input-wrapper">
                        <textarea class="chat-input" id="chat-input" 
                                  placeholder="Type your message here... (Use / for commands, Shift+Enter for new line)" 
                                  rows="1"></textarea>
                        <button class="send-btn" id="send-btn" onclick="sendMessage()">
                            <i class="fas fa-paper-plane"></i> Send
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modals -->
    <div class="modal" id="api-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">API Configuration</h3>
                <button class="modal-close" onclick="closeModal('api-modal')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="section">
                    <h3 class="section-title">Get Free API Keys</h3>
                    <div style="display: flex; flex-direction: column; gap: 15px;">
                        <a href="https://openrouter.ai/keys" target="_blank" class="btn btn-primary" style="text-align: left; justify-content: flex-start;">
                            <i class="fas fa-exchange-alt"></i> Get OpenRouter Key (Recommended)
                            <span style="margin-left: auto; font-size: 0.8rem;">$1 free credits</span>
                        </a>
                        
                        <a href="https://makersuite.google.com/app/apikey" target="_blank" class="btn btn-secondary" style="text-align: left; justify-content: flex-start;">
                            <i class="fab fa-google"></i> Get Google Gemini Key
                            <span style="margin-left: auto; font-size: 0.8rem;">Free tier</span>
                        </a>
                        
                        <a href="https://platform.deepseek.com/api_keys" target="_blank" class="btn btn-secondary" style="text-align: left; justify-content: flex-start;">
                            <i class="fas fa-brain"></i> Get DeepSeek Key
                            <span style="margin-left: auto; font-size: 0.8rem;">New accounts only</span>
                        </a>
                    </div>
                    
                    <div style="margin-top: 25px; padding: 15px; background: rgba(16, 185, 129, 0.1); border-radius: 10px; border: 1px solid rgba(16, 185, 129, 0.2);">
                        <h4 style="color: var(--secondary); margin-bottom: 10px;">
                            <i class="fas fa-lightbulb"></i> Recommendation
                        </h4>
                        <p style="color: var(--gray); line-height: 1.5; font-size: 0.95rem;">
                            Use <strong>OpenRouter</strong> for immediate access to DeepSeek models with free credits.
                            Your current DeepSeek key has no credits remaining.
                        </p>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('api-modal')">Cancel</button>
                <button class="btn btn-primary" onclick="closeModal('api-modal')">Done</button>
            </div>
        </div>
    </div>

    <!-- Context Menu -->
    <div class="context-menu" id="context-menu">
        <div class="context-item" onclick="copyMessage()">
            <i class="fas fa-copy"></i>
            <span>Copy</span>
        </div>
        <div class="context-item" onclick="editMessage()">
            <i class="fas fa-edit"></i>
            <span>Edit</span>
        </div>
        <div class="context-item" onclick="regenerateMessage()">
            <i class="fas fa-redo"></i>
            <span>Regenerate</span>
        </div>
        <div class="context-divider"></div>
        <div class="context-item" onclick="deleteMessage()">
            <i class="fas fa-trash"></i>
            <span style="color: var(--danger);">Delete</span>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
    <script>
        // Initialize app
        let appState = {
            currentAPI: 'openrouter',
            apiKey: localStorage.getItem('openrouter_api_key') || '',
            model: 'deepseek/deepseek-chat',
            temperature: 0.7,
            maxTokens: 2000,
            messages: [],
            isConnected: false,
            isTyping: false,
            conversationId: generateId(),
            stats: {
                totalRequests: 0,
                totalTokens: 0,
                responseTimes: [],
                successCount: 0,
                failCount: 0
            }
        };

        // DOM Elements
        const chatInput = document.getElementById('chat-input');
        const sendBtn = document.getElementById('send-btn');
        const messagesContainer = document.getElementById('messages-container');
        const welcomeScreen = document.getElementById('welcome-screen');
        const typingIndicator = document.getElementById('typing-indicator');
        const apiKeyInput = document.getElementById('api-key-input');
        const saveApiBtn = document.getElementById('save-api-btn');
        const testApiBtn = document.getElementById('test-api-btn');
        const apiOptions = document.querySelectorAll('.api-option');
        const sidebarTabs = document.querySelectorAll('.sidebar-tab');
        const tabContents = document.querySelectorAll('.tab-content');
        const temperatureSlider = document.getElementById('temperature-slider');
        const maxTokensSlider = document.getElementById('max-tokens-slider');
        const topPSlider = document.getElementById('top-p-slider');
        const tempValue = document.getElementById('temp-value');
        const maxTokensValue = document.getElementById('max-tokens-value');
        const topPValue = document.getElementById('top-p-value');
        const statsElements = {
            requests: document.getElementById('total-requests'),
            tokens: document.getElementById('total-tokens'),
            responseTime: document.getElementById('response-time'),
            successRate: document.getElementById('success-rate')
        };

        // Initialize
        function init() {
            loadSettings();
            setupEventListeners();
            updateStatsDisplay();
            
            if (appState.apiKey) {
                apiKeyInput.value = '';
                testConnection();
            }
            
            // Load conversation if exists
            const savedConversation = localStorage.getItem(`conversation_${appState.conversationId}`);
            if (savedConversation) {
                appState.messages = JSON.parse(savedConversation);
                if (appState.messages.length > 0) {
                    showChatInterface();
                    appState.messages.forEach(msg => renderMessage(msg.role, msg.content, msg.timestamp));
                }
            }
        }

        // Setup event listeners
        function setupEventListeners() {
            // Chat input
            chatInput.addEventListener('input', handleInput);
            chatInput.addEventListener('keydown', handleKeyDown);
            
            // API buttons
            saveApiBtn.addEventListener('click', saveApiKey);
            testApiBtn.addEventListener('click', testConnection);
            
            // API selection
            apiOptions.forEach(option => {
                option.addEventListener('click', () => {
                    apiOptions.forEach(opt => opt.classList.remove('active'));
                    option.classList.add('active');
                    appState.currentAPI = option.dataset.api;
                    updateApiStatus();
                });
            });
            
            // Sidebar tabs
            sidebarTabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    const tabId = tab.dataset.tab;
                    sidebarTabs.forEach(t => t.classList.remove('active'));
                    tab.classList.add('active');
                    tabContents.forEach(content => {
                        content.classList.remove('active');
                        if (content.id === `${tabId}-tab`) {
                            content.classList.add('active');
                        }
                    });
                });
            });
            
            // Sliders
            temperatureSlider.addEventListener('input', () => {
                appState.temperature = temperatureSlider.value / 10;
                tempValue.textContent = appState.temperature.toFixed(1);
                saveSettings();
            });
            
            maxTokensSlider.addEventListener('input', () => {
                appState.maxTokens = parseInt(maxTokensSlider.value);
                maxTokensValue.textContent = appState.maxTokens.toLocaleString();
                saveSettings();
            });
            
            topPSlider.addEventListener('input', () => {
                const topP = topPSlider.value / 10;
                topPValue.textContent = topP.toFixed(1);
                saveSettings();
            });
            
            // Tool buttons
            document.getElementById('attach-file-btn').addEventListener('click', attachFile);
            document.getElementById('code-mode-btn').addEventListener('click', toggleCodeMode);
            document.getElementById('new-chat-btn').addEventListener('click', newChat);
            document.getElementById('voice-input-btn').addEventListener('click', toggleVoiceInput);
            document.getElementById('help-btn').addEventListener('click', () => showModal('api-modal'));
            
            // Context menu
            document.addEventListener('click', () => {
                document.getElementById('context-menu').style.display = 'none';
            });
            
            // File upload
            document.addEventListener('dragover', handleDragOver);
            document.addEventListener('drop', handleFileDrop);
        }

        // Handle chat input
        function handleInput() {
            // Auto-resize
            chatInput.style.height = 'auto';
            chatInput.style.height = Math.min(chatInput.scrollHeight, 200) + 'px';
            
            // Check for commands
            if (chatInput.value.startsWith('/')) {
                showCommandSuggestions();
            }
            
            // Update send button
            sendBtn.disabled = !appState.isConnected || chatInput.value.trim() === '';
        }

        // Handle keyboard shortcuts
        function handleKeyDown(e) {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                if (!sendBtn.disabled) {
                    sendMessage();
                }
            } else if (e.key === '/' && chatInput.value === '') {
                e.preventDefault();
                chatInput.value = '/';
                handleInput();
            }
        }

        // Save API key
        function saveApiKey() {
            let key = apiKeyInput.value.trim();
            
            // If showing dots, use stored key
            if (key === '') {
                key = appState.apiKey;
            }
            
            if (!key) {
                alert('Please enter an API key');
                return;
            }
            
            const keyType = getKeyType(key);
            if (!keyType) {
                alert('Invalid API key format. Should start with "sk-or-v1-" for OpenRouter or "sk-" for DeepSeek');
                return;
            }
            
            appState.apiKey = key;
            appState.currentAPI = keyType;
            localStorage.setItem(`${keyType}_api_key`, key);
            apiKeyInput.value = '';
            updateApiStatus();
            testConnection();
        }

        // Get key type
        function getKeyType(key) {
            if (key.startsWith('sk-or-v1-')) return 'openrouter';
            if (key.startsWith('sk-')) return 'deepseek';
            return null;
        }

        // Test API connection
        async function testConnection() {
            if (!appState.apiKey) {
                alert('Please enter an API key first');
                return;
            }
            
            updateConnectionStatus('Testing connection...', false);
            
            try {
                let url, headers;
                
                if (appState.currentAPI === 'openrouter') {
                    url = 'https://openrouter.ai/api/v1/models';
                    headers = {
                        'Authorization': `Bearer ${appState.apiKey}`,
                        'HTTP-Referer': window.location.origin,
                        'X-Title': 'AI Agent Pro'
                    };
                } else if (appState.currentAPI === 'deepseek') {
                    url = 'https://api.deepseek.com/v1/models';
                    headers = {
                        'Authorization': `Bearer ${appState.apiKey}`,
                        'Content-Type': 'application/json'
                    };
                }
                
                const response = await fetch(url, { headers });
                
                if (response.ok) {
                    updateConnectionStatus('Connected ', true);
                    showChatInterface();
                    addSystemMessage('Connection established! You can now start chatting.');
                } else if (response.status === 402) {
                    updateConnectionStatus('No credits ', false);
                    showModal('api-modal');
                    addSystemMessage(' Your API key has no credits. Please use OpenRouter for free access.');
                } else {
                    throw new Error(`HTTP ${response.status}`);
                }
            } catch (error) {
                updateConnectionStatus('Connection failed ', false);
                console.error('Connection test failed:', error);
            }
        }

        // Update connection status
        function updateConnectionStatus(message, connected) {
            appState.isConnected = connected;
            sendBtn.disabled = !connected || chatInput.value.trim() === '';
            
            // Update status dot
            const statusDot = document.querySelector(`.api-option[data-api="${appState.currentAPI}"] .status-dot`);
            if (statusDot) {
                statusDot.className = `status-dot ${connected ? 'online' : 'offline'}`;
                const statusText = statusDot.nextElementSibling;
                if (statusText) statusText.textContent = message;
            }
        }

        // Update API status display
        function updateApiStatus() {
            apiOptions.forEach(option => {
                const statusDot = option.querySelector('.status-dot');
                const statusText = statusDot.nextElementSibling;
                
                if (option.dataset.api === appState.currentAPI) {
                    if (appState.isConnected) {
                        statusDot.className = 'status-dot online';
                        statusText.textContent = 'Connected ';
                    } else {
                        statusDot.className = 'status-dot offline';
                        statusText.textContent = 'Not connected';
                    }
                } else {
                    statusDot.className = 'status-dot offline';
                    statusText.textContent = 'Not selected';
                }
            });
        }

        // Send message
        async function sendMessage() {
            const message = chatInput.value.trim();
            if (!message || !appState.isConnected) return;
            
            // Add user message
            addMessage('user', message);
            chatInput.value = '';
            chatInput.style.height = 'auto';
            sendBtn.disabled = true;
            
            // Show typing indicator
            showTypingIndicator();
            
            // Start timing
            const startTime = Date.now();
            
            try {
                let response;
                
                if (appState.currentAPI === 'openrouter') {
                    response = await callOpenRouterAPI(message);
                } else if (appState.currentAPI === 'deepseek') {
                    response = await callDeepSeekAPI(message);
                }
                
                // Hide typing indicator
                hideTypingIndicator();
                
                // Calculate response time
                const responseTime = (Date.now() - startTime) / 1000;
                appState.stats.responseTimes.push(responseTime);
                appState.stats.successCount++;
                appState.stats.totalRequests++;
                
                // Add AI response
                addMessage('assistant', response);
                
                // Save conversation
                saveConversation();
                
            } catch (error) {
                hideTypingIndicator();
                appState.stats.failCount++;
                appState.stats.totalRequests++;
                
                let errorMessage;
                if (error.message.includes('402') || error.message.includes('credits')) {
                    errorMessage = 'API key has no credits. Please use OpenRouter for free access.';
                    showModal('api-modal');
                } else {
                    errorMessage = `Error: ${error.message}`;
                }
                
                addMessage('assistant', errorMessage);
                updateConnectionStatus('Error ', false);
            }
            
            updateStatsDisplay();
            sendBtn.disabled = chatInput.value.trim() === '';
            chatInput.focus();
        }

        // Call OpenRouter API
        async function callOpenRouterAPI(message) {
            const headers = {
                'Authorization': `Bearer ${appState.apiKey}`,
                'HTTP-Referer': window.location.origin,
                'X-Title': 'AI Agent Pro',
                'Content-Type': 'application/json'
            };
            
            const body = {
                model: appState.model,
                messages: [
                    {
                        role: 'system',
                        content: 'You are a helpful AI assistant with advanced capabilities in coding, analysis, writing, and problem-solving.'
                    },
                    ...appState.messages.slice(-20).map(msg => ({
                        role: msg.role,
                        content: msg.content
                    })),
                    { role: 'user', content: message }
                ],
                temperature: appState.temperature,
                max_tokens: appState.maxTokens
            };
            
            const response = await fetch('https://openrouter.ai/api/v1/chat/completions', {
                method: 'POST',
                headers,
                body: JSON.stringify(body)
            });
            
            if (!response.ok) {
                throw new Error(`HTTP ${response.status}: ${response.statusText}`);
            }
            
            const data = await response.json();
            
            // Update token usage
            if (data.usage) {
                appState.stats.totalTokens += data.usage.total_tokens;
            }
            
            return data.choices[0].message.content;
        }

        // Call DeepSeek API
        async function callDeepSeekAPI(message) {
            const headers = {
                'Authorization': `Bearer ${appState.apiKey}`,
                'Content-Type': 'application/json'
            };
            
            const body = {
                model: 'deepseek-chat',
                messages: [
                    {
                        role: 'system',
                        content: 'You are a helpful AI assistant.'
                    },
                    ...appState.messages.slice(-20).map(msg => ({
                        role: msg.role,
                        content: msg.content
                    })),
                    { role: 'user', content: message }
                ],
                temperature: appState.temperature,
                max_tokens: appState.maxTokens
            };
            
            const response = await fetch('https://api.deepseek.com/v1/chat/completions', {
                method: 'POST',
                headers,
                body: JSON.stringify(body)
            });
            
            if (!response.ok) {
                if (response.status === 402) {
                    throw new Error('402: Payment required. No credits available.');
                }
                throw new Error(`HTTP ${response.status}: ${response.statusText}`);
            }
            
            const data = await response.json();
            
            // Update token usage
            if (data.usage) {
                appState.stats.totalTokens += data.usage.total_tokens;
            }
            
            return data.choices[0].message.content;
        }

        // Add message to chat
        function addMessage(role, content) {
            const timestamp = new Date().toISOString();
            const message = { role, content, timestamp };
            
            appState.messages.push(message);
            renderMessage(role, content, timestamp);
            
            // Show chat interface if on welcome screen
            if (welcomeScreen.style.display !== 'none') {
                showChatInterface();
            }
        }

        // Add system message
        function addSystemMessage(content) {
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message system';
            messageDiv.innerHTML = `
                <div style="text-align: center; margin: 20px 0;">
                    <div style="display: inline-block; background: rgba(59, 130, 246, 0.1); color: #60a5fa; padding: 10px 20px; border-radius: 20px; font-size: 0.9rem; border: 1px solid rgba(59, 130, 246, 0.2);">
                        <i class="fas fa-info-circle"></i> ${content}
                    </div>
                </div>
            `;
            messagesContainer.appendChild(messageDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        // Render message
        function renderMessage(role, content, timestamp) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${role}`;
            
            const time = new Date(timestamp).toLocaleTimeString([], { 
                hour: '2-digit', 
                minute: '2-digit' 
            });
            
            const avatar = role === 'user' ? 'U' : 'AI';
            const avatarClass = role === 'user' ? 'user' : 'ai';
            const senderName = role === 'user' ? 'You' : 'AI Assistant';
            
            // Format content with markdown
            const formattedContent = formatMessage(content);
            
            messageDiv.innerHTML = `
                <div class="message-header">
                    <div class="message-avatar ${avatarClass}">${avatar}</div>
                    <div class="message-info">
                        <div class="message-sender">${senderName}</div>
                        <div class="message-time">${time}</div>
                    </div>
                    <div class="message-actions">
                        <button class="message-action" onclick="copyToClipboard(this)">
                            <i class="fas fa-copy"></i>
                        </button>
                        <button class="message-action" onclick="regenerateMessage(this)">
                            <i class="fas fa-redo"></i>
                        </button>
                    </div>
                </div>
                <div class="message-content">${formattedContent}</div>
            `;
            
            messagesContainer.appendChild(messageDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
            
            // Highlight code blocks
            messageDiv.querySelectorAll('pre code').forEach(block => {
                hljs.highlightElement(block);
            });
        }

        // Format message with markdown
        function formatMessage(content) {
            // Convert markdown to HTML
            content = content.replace(/```(\w+)?\n([\s\S]*?)```/g, (match, lang, code) => {
                lang = lang || 'plaintext';
                return `<pre><code class="language-${lang}">${escapeHtml(code)}</code></pre>`;
            });
            
            content = content.replace(/`([^`]+)`/g, '<code>$1</code>');
            content = content.replace(/\*\*([^*]+)\*\*/g, '<strong>$1</strong>');
            content = content.replace(/\*([^*]+)\*/g, '<em>$1</em>');
            content = content.replace(/^### (.*$)/gm, '<h3>$1</h3>');
            content = content.replace(/^## (.*$)/gm, '<h2>$1</h2>');
            content = content.replace(/^# (.*$)/gm, '<h1>$1</h1>');
            content = content.replace(/\[([^\]]+)\]\(([^)]+)\)/g, '<a href="$2" target="_blank">$1</a>');
            content = content.replace(/^- (.*$)/gm, '<li>$1</li>');
            content = content.replace(/(<li>.*<\/li>)/g, '<ul>$1</ul>');
            content = content.replace(/\n/g, '<br>');
            
            return content;
        }

        // Escape HTML
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // Show typing indicator
        function showTypingIndicator() {
            typingIndicator.style.display = 'flex';
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        // Hide typing indicator
        function hideTypingIndicator() {
            typingIndicator.style.display = 'none';
        }

        // Show chat interface
        function showChatInterface() {
            welcomeScreen.style.display = 'none';
            messagesContainer.style.display = 'block';
        }

        // Save conversation
        function saveConversation() {
            localStorage.setItem(`conversation_${appState.conversationId}`, JSON.stringify(appState.messages));
            localStorage.setItem('appState', JSON.stringify(appState));
        }

        // Load settings
        function loadSettings() {
            const savedState = localStorage.getItem('appState');
            if (savedState) {
                const parsed = JSON.parse(savedState);
                Object.assign(appState, parsed);
            }
        }

        // Save settings
        function saveSettings() {
            localStorage.setItem('appState', JSON.stringify(appState));
        }

        // Update stats display
        function updateStatsDisplay() {
            statsElements.requests.textContent = appState.stats.totalRequests;
            statsElements.tokens.textContent = appState.stats.totalTokens.toLocaleString();
            
            if (appState.stats.responseTimes.length > 0) {
                const avgTime = appState.stats.responseTimes.reduce((a, b) => a + b, 0) / appState.stats.responseTimes.length;
                statsElements.responseTime.textContent = `${avgTime.toFixed(1)}s`;
            }
            
            const totalRequests = appState.stats.successCount + appState.stats.failCount;
            if (totalRequests > 0) {
                const successRate = (appState.stats.successCount / totalRequests) * 100;
                statsElements.successRate.textContent = `${successRate.toFixed(0)}%`;
            }
        }

        // Show modal
        function showModal(modalId) {
            document.getElementById(modalId).style.display = 'flex';
        }

        // Close modal
        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        // Generate ID
        function generateId() {
            return Date.now().toString(36) + Math.random().toString(36).substr(2);
        }

        // Quick actions
        function quickAction(type) {
            const prompts = {
                code: "Write a Python function to calculate Fibonacci numbers with error handling and docstring.",
                analyze: "Analyze this dataset and provide insights: [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]",
                write: "Write a professional email requesting a meeting about project collaboration.",
                learn: "Explain quantum computing in simple terms with analogies for beginners."
            };
            
            chatInput.value = prompts[type];
            handleInput();
            chatInput.focus();
        }

        // Copy to clipboard
        function copyToClipboard(button) {
            const messageContent = button.closest('.message').querySelector('.message-content').textContent;
            navigator.clipboard.writeText(messageContent).then(() => {
                const icon = button.querySelector('i');
                const originalClass = icon.className;
                icon.className = 'fas fa-check';
                setTimeout(() => {
                    icon.className = originalClass;
                }, 2000);
            });
        }

        // Regenerate message
        function regenerateMessage(button) {
            const messageDiv = button.closest('.message');
            if (messageDiv.classList.contains('user')) {
                const userMessage = messageDiv.querySelector('.message-content').textContent;
                messageDiv.remove();
                const index = appState.messages.findIndex(m => m.content === userMessage);
                if (index !== -1) {
                    appState.messages.splice(index, 1);
                }
                chatInput.value = userMessage;
                handleInput();
                chatInput.focus();
            }
        }

        // New chat
        function newChat() {
            if (appState.messages.length > 0) {
                if (confirm('Start a new chat? Current conversation will be saved.')) {
                    appState.conversationId = generateId();
                    appState.messages = [];
                    messagesContainer.innerHTML = '';
                    welcomeScreen.style.display = 'flex';
                    messagesContainer.style.display = 'none';
                    saveConversation();
                }
            }
        }

        // Toggle voice input
        function toggleVoiceInput() {
            alert('Voice input requires browser microphone permission. This feature will be implemented in the next update.');
        }

        // Attach file
        function attachFile() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.txt,.pdf,.doc,.docx,.json,.csv,.py,.js,.html,.css';
            input.onchange = handleFileSelect;
            input.click();
        }

        // Handle file select
        function handleFileSelect(e) {
            const file = e.target.files[0];
            if (!file) return;
            
            if (file.size > 5 * 1024 * 1024) {
                alert('File too large. Maximum size is 5MB.');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(event) {
                const content = event.target.result;
                addMessage('user', `[File: ${file.name}]\n\n${content.substring(0, 5000)}...`);
            };
            reader.readAsText(file);
        }

        // Handle drag over
        function handleDragOver(e) {
            e.preventDefault();
            e.stopPropagation();
            e.dataTransfer.dropEffect = 'copy';
        }

        // Handle file drop
        function handleFileDrop(e) {
            e.preventDefault();
            e.stopPropagation();
            
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                handleFileSelect({ target: { files } });
            }
        }

        // Toggle code mode
        function toggleCodeMode() {
            const btn = document.getElementById('code-mode-btn');
            btn.classList.toggle('active');
            
            if (btn.classList.contains('active')) {
                chatInput.value = '```python\n# Write your code here\n\ndef hello_world():\n    print("Hello, World!")\n```\n';
                handleInput();
                chatInput.focus();
            }
        }

        // Show command suggestions
        function showCommandSuggestions() {
            // This would show a dropdown with command suggestions
            // Implement as needed
        }

        // Initialize the app
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>